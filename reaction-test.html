<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Reaction Time Tester</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      text-align: center;
      padding: 30px;
    }

    #box {
      width: 200px;
      height: 200px;
      background: #374151;
      margin: 30px auto;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      cursor: pointer;
      user-select: none;
    }

    #box.green {
      background: #22c55e;
    }

    button {
      padding: 12px 24px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      background: #3b82f6;
      color: white;
      cursor: pointer;
    }

    #status {
      margin-top: 15px;
      font-size: 18px;
      font-weight: bold;
    }

    #timer {
      margin-top: 10px;
      font-size: 16px;
      color: #38bdf8;
    }

    #leaderboard {
      margin-top: 25px;
    }

    .lb {
      background: #020617;
      padding: 8px;
      border-radius: 6px;
      margin: 5px auto;
      max-width: 260px;
      text-align: left;
    }
  </style>
</head>

<body>

<h1>Reaction Time Tester</h1>
<p>Click when the box turns green</p>

<button onclick="startGame()">Start</button>

<div id="status">Waiting to start‚Ä¶</div>
<div id="timer">Time: 0 ms</div>

<div id="box">IDLE</div>

<div id="leaderboard"></div>

<script>
  const box = document.getElementById("box");
  const statusEl = document.getElementById("status");
  const timerEl = document.getElementById("timer");
  const leaderboardDiv = document.getElementById("leaderboard");

  // üîê PLAYER NAME
  let playerName = localStorage.getItem("playerName");
  if (!playerName) {
    playerName = prompt("Enter your name:");
    if (!playerName) playerName = "Player";
    localStorage.setItem("playerName", playerName);
  }

  // üîä AUDIO SETUP (Web Audio API)
  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

  function beep(freq, duration) {
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.frequency.value = freq;
    osc.type = "sine";
    gain.gain.value = 0.1;

    osc.connect(gain);
    gain.connect(audioCtx.destination);

    osc.start();
    setTimeout(() => osc.stop(), duration);
  }

  function vibrate(pattern) {
    if ("vibrate" in navigator) {
      navigator.vibrate(pattern);
    }
  }

  let gameStartTime = 0;
  let gameTimerInterval;
  let reactionStart = 0;
  let canClick = false;

  let leaderboard = JSON.parse(localStorage.getItem("reactionLB")) || [];

  function startGame() {
    audioCtx.resume(); // required for mobile audio
    canClick = false;
    box.classList.remove("green");
    box.textContent = "GET READY‚Ä¶";
    statusEl.textContent = `üü¢ GAME STARTED ‚Äî ${playerName}`;

    gameStartTime = performance.now();
    clearInterval(gameTimerInterval);
    gameTimerInterval = setInterval(updateGameTimer, 10);

    const delay = Math.random() * 3000 + 1000;

    setTimeout(() => {
      box.classList.add("green");
      box.textContent = "CLICK!";
      reactionStart = performance.now();
      canClick = true;

      beep(800, 120);      // üîä green beep
      vibrate(50);         // üì≥ short vibration
    }, delay);
  }

  function updateGameTimer() {
    const elapsedMs = Math.floor(performance.now() - gameStartTime);
    timerEl.textContent = `Time: ${elapsedMs} ms`;
  }

  box.onclick = () => {
    if (!canClick) {
      beep(200, 150);     // ‚ùå early click sound
      vibrate([30, 50, 30]);
      return;
    }

    const reaction = Math.round(performance.now() - reactionStart);
    canClick = false;

    clearInterval(gameTimerInterval);
    box.classList.remove("green");
    box.textContent = "DONE";

    beep(1200, 100);      // ‚úÖ success sound
    vibrate(100);         // üì≥ success vibration

    statusEl.textContent = `‚ö° ${playerName}'s Reaction: ${reaction} ms`;

    saveScore(playerName, reaction);
    renderLeaderboard();
  };

  function saveScore(name, time) {
    leaderboard.push({ name, time });
    leaderboard.sort((a, b) => a.time - b.time);
    leaderboard = leaderboard.slice(0, 5);
    localStorage.setItem("reactionLB", JSON.stringify(leaderboard));
  }

  function renderLeaderboard() {
    leaderboardDiv.innerHTML = "<h3>üèÜ Leaderboard</h3>";
    leaderboard.forEach((entry, i) => {
      leaderboardDiv.innerHTML += `
        <div class="lb">
          ${i + 1}. <b>${entry.name}</b> ‚Äî ${entry.time} ms
        </div>
      `;
    });
  }

  renderLeaderboard();
</script>

</body>
</html>